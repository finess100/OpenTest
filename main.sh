#!/bin/bash
##########
##~~ Initialisation

start=$(date +%s.%N)
echo -e "\e[97m"

echo "On est dans Main.sh"

rm -f results/live && touch results/live
rm -f all/*
rm -f config/objets && touch config/objets

chmod +x template/*
chmod +x rules/*

# Init des valeurs de règles

# Le prix
prix_max=20
touch temp/rules/prix
echo -n $prix_max > temp/rules/prix

# Le poids
poids_max=30
touch temp/rules/poids
echo -n $poids_max > temp/rules/poids

# La couleur
couleur_max="Bleu Noir"
touch temp/rules/couleur
echo -n $couleur_max > temp/rules/couleur

##~~ Lancement du live des logs fichiers

runtime=$(echo "$(date +%s.%N) - $start" | bc)
echo "Runtime Avant live : $runtime"

sh config/tracker_live.sh &

########

########
##~~ Lecture ou Création des objets
objets_a_creer=4

for o in `seq 1 $objets_a_creer`;do

##~~ Gestion du chargement graphique

le_chargement=$((100 * $o / $objets_a_creer))
chargement=$(perl -E "say '=' x $le_chargement")
echo -e "> [$le_chargement%] [$chargement]"

#######
##~~ Randomisation des critères/attributs/caractéristiques d'objets

prix_rand=$(( ( RANDOM % 30 )  + 1 ))

poids_rand=$(( ( RANDOM % 50 )  + 1 ))

couleur_texte="Bleu;Orange;Noir;Blanc;Violet"
couleur_rand=$(( ( RANDOM % 5 )  + 1))
couleur_choix=$(echo $couleur_texte | cut -d";" -f$couleur_rand )

nom_rand=$(date +%s%N | tr -d '[:space:]')

#########

#########
##~~ Fixation de l'objet sous ligne de fichier

echo "id:$o;nom:$nom_rand;prix:$prix_rand;poids:$poids_rand;couleur_choix:$couleur_choix" >> config/objets

#./template/classique "id:$o";nom:$nom_rand;prix:$prix_rand;poids:$poids_rand;couleur_choix:$couleur_choix"

./template/classique "$o" "$nom_rand" "$prix_rand" "$poids_rand" "$couleur_choix" &

done

runtime=$(echo "$(date +%s.%N) - $start" | bc)
echo "Runtime -- Aprés lancement des Objets de dimension 1 : $runtime"

#sh config/tracker_live.sh
