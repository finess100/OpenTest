#!/bin/bash
start=$(date +%s.%N)
echo -e "\e[97m"

echo "On est dans Main.sh"

rm -f results/live && touch results/live
rm -f all/*
rm -f config/objets && touch config/objets

#Init des objets
objets_a_creer=3

for o in `seq 1 $objets_a_creer`;do

le_chargement=$((100 * $o / $objets_a_creer))
chargement=$(perl -E "say '=' x $le_chargement")
echo -e "> [$le_chargement%] [$chargement]"

prix_rand=$(( ( RANDOM % 8 )  + 1 ))

poids_rand=$(( ( RANDOM % 8 )  + 1 ))

couleur_texte="Bleu;Orange;Noir;Blanc;Violet"
couleur_rand=$(( ( RANDOM % 5 )  + 1))
couleur_choix=$(echo $couleur_texte | cut -d";" -f$couleur_rand )

nom_rand=$(date +%s%N | tr -d '[:space:]')

echo "id:$o;nom:$nom_rand;prix:$prix_rand;poids:$poids_rand;couleur_choix:$couleur_choix" >> config/objets

done

liste_objets=$(cat config/objets)

# Export de la liste des objets en variable d'environnement toutes les minutes

#chmod +x config/var_env_objet.sh && ./config/var_env_objet.sh &

# Export du nombre de ligne d'objets

# Init des valeurs de rÃ¨gles

# Le prix
prix_max=5
touch temp/rules/prix
echo -n $prix_max > temp/rules/prix

# Le poids
poids_max=6
touch temp/rules/poids
echo -n $poids_max > temp/rules/poids

# La couleur
couleur_max="Bleu Noir"
touch temp/rules/couleur
echo -n $couleur_max > temp/rules/couleur

runtime=$(echo "$(date +%s.%N) - $start" | bc)
echo "Runtime Avant live : $runtime"

sh config/tracker_live.sh &
#Parcours des objets
for objet in $liste_objets;do

 ###cp template/classique all/$objet.sh
 ###sh all/$objet.sh $objet &
 chmod +x template/classique && ./template/classique $objet &

done

runtime=$(echo "$(date +%s.%N) - $start" | bc)
echo "Runtime main.sh : $runtime"

#sh config/tracker_live.sh
