#!/bin/bash
#echo "Objet $1 au rapport"

start=$(date +%s.%N)

objet_valeurs=$1

objet_id=$(echo $objet_valeurs | cut -d";" -f1 | cut -d":" -f2 )
objet_nom=$(echo $objet_valeurs | cut -d";" -f2 | cut -d":" -f2 )
objet_prix=$(echo $objet_valeurs | cut -d";" -f3 | cut -d":" -f2 )
objet_poids=$(echo $objet_valeurs | cut -d";" -f4 | cut -d":" -f2 )
objet_couleur=$(echo $objet_valeurs | cut -d";" -f5 | cut -d":" -f2 )

#echo "objet_id=$objet_id"
#echo "objet_nom=$objet_nom"
#echo "objet_prix=$objet_prix"
#echo "objet_poids=$objet_poids"
#echo "objet_couleur=$objet_couleur"

#~~ Calcul des rÃ¨gles

# Le prix # Le poids # La couleur
./rules/prix.sh $objet_id $objet_nom $objet_prix;./rules/poids.sh $objet_id $objet_nom $objet_poids;./rules/couleur.sh $objet_id $objet_nom $objet_couleur 

jackpot=false

if [[ $? -eq 0 ]];then

echo -e "\e[35m`date +%s%N` ($objet_id : $objet_nom) JACKPOT - OK\e[97m" >> ./results/live
jackpot=true

fi

# Les deux

#~~ Essai : boucle de lancement des enfants

fichier_objet=$(cat config/objets)

for objet in $fichier_objet;do

	echo "objet_id = $objet_id"

	objet_enfant_id=$(echo $objet | cut -d";" -f1 | cut -d":" -f2 )
	
	if [[ $objet_id != $objet_enfant_id ]] || [[ $jackpot ]];then
	
		./template/dimension "$objet_id $objet_enfant_id"
	
	fi

done

runtime=$(echo "$(date +%s.%N) - $start" | bc)
echo "Runtime template classique $objet_id: $runtime"
